REPORT DIAGNOSI MOBILE SAFE AREAS - WineNode
Data: 28/09/2025 16:17 (AGGIORNATO)
Versione: 1.1.0

=== 1. VIEWPORT & UNITS ===
- Unità altezza: 100vh (problematico su iOS Safari)
- Workaround iOS Safari: NON PRESENTE (causa potenziale)
- Viewport meta: standard (width=device-width, initial-scale=1)
- Units moderne (svh/dvh): NON UTILIZZATE

PROBLEMA IDENTIFICATO: Uso rigido di 100vh causa salti quando barra URL iOS appare/scompare

=== 2. SAFE-AREA ATTUALE ===
Home:
- Padding bottom: calc(var(--safe-bottom) + 12pt) 
- Padding top: 6pt
- Safe-area variables: --safe-bottom, --safe-left, --safe-right definite
- Compensazione contenuto: INSUFFICIENTE

Gestisci Ordine:
- Header sticky top: calc(var(--safe-area-inset-top, 0px) + 80px)
- Padding contenuto: calc(var(--header-height, 88px) + 20px)
- Safe-area top: PARZIALMENTE IMPLEMENTATA

PROBLEMA: Safe-area bottom non correttamente applicata alle liste scrollabili

=== 3. BOTTOM NAVBAR ===
Struttura DOM:
- Gruppo icone: .nav-icons-group (PRESENTE)
- Pill "Tutti": .btn-tutti separato (CORRETTO)
- Layout: display: flex, justify-content: space-between

Dimensioni:
- Altezza barra: 56-64pt (min-max)
- Container icone: 44pt (touch target)
- Offset verticale icone: CENTRATO (problema: dovrebbe essere +25% verso basso)
- Z-index barra: var(--z-navbar)
- Z-index "Tutti": STESSO LIVELLO

Lente:
- Posizione: A destra campanella (CORRETTO)
- Asset: lente.png con mask pattern (CORRETTO)
- Hit-area: 44pt (CONFORME)

PROBLEMA PRINCIPALE: Icone centrate verticalmente invece di spostate verso basso del 25%

=== 4. GESTISCI ORDINE (HEADER/LOGO) ===
Header:
- Posizionamento: sticky
- Top value: calc(var(--safe-area-inset-top, 0px) + 80px)
- Z-index: 40
- Background: #fff9dc con border-b

Logo:
- Posizione: Header fisso sopra sticky
- Margini: POTENZIALE CONFLITTO con safe-area
- Overflow: NON PROBLEMATICO
- Compensazione safe-area top: PARZIALE

PROBLEMA: Header sticky potrebbe non compensare correttamente safe-area su tutti i device

=== 5. REGOLE GLOBALI INTERFERENTI ===
Reset globali:
- Button: appearance: none, border: none (CORRETTO)
- SVG: fill/stroke gestiti localmente (CORRETTO)
- Line-height: STANDARD
- Overflow: touch scrolling attivo (CORRETTO)
- Position: sticky supportato (CORRETTO)

Z-index stack:
- Navbar: var(--z-navbar) 
- Header sticky: 40
- Modali: 50-60
- POTENZIALE CONFLITTO: z-index non definiti chiaramente

=== CAUSE PROBABILI IDENTIFICATE ===

1. NAVBAR ICONE TROPPO ALTE:
   - Icone centrate verticalmente nel container
   - Manca offset verso basso del 25%
   - Safe-area bottom non correttamente applicata

2. GESTISCI ORDINE HEADER:
   - Safe-area top compensation insufficiente
   - Sticky top value potrebbe essere troppo basso
   - Logo header fisso potrebbe sovrapporsi

3. VIEWPORT iOS:
   - Uso rigido 100vh causa instabilità
   - Mancano unità moderne svh/dvh
   - Barra URL Safari non gestita

4. LISTE SCROLLABILI:
   - Padding-bottom insufficiente
   - Contenuto scorre sotto navbar
   - Safe-area bottom non propagata

=== PRIORITÀ INTERVENTI ===

CRITICO:
1. Spostare icone navbar verso basso 25%
2. Implementare safe-area bottom per liste
3. Correggere header Gestisci Ordine

IMPORTANTE:
4. Sostituire 100vh con svh/dvh dove necessario
5. Definire z-index stack coerente

OTTIMIZZAZIONE:
6. Migliorare compensazioni safe-area globali
7. Test su device reali iOS/Android

=== MISURE ATTUALI (da correggere) ===
- Navbar height: 56-64pt
- Icon container: 44pt (centrato)
- Safe-area bottom: calc(var(--safe-bottom) + 12pt)
- Header sticky top: 80px + safe-area
- Lista padding-bottom: 100px (FISSO, dovrebbe essere dinamico)

=== MISURE TARGET (post-fix) ===
- Icon vertical offset: +25% container height (~11-16pt verso basso)
- Lista padding-bottom: navbar-height + safe-area-bottom
- Header sticky top: safe-area-top + design-offset
- Viewport: min(100svh, 100dvh) dove applicabile

=== ANALISI DETTAGLIATA CODICE ATTUALE ===

NAVBAR STRUCTURE (mobile-standard.css):
- Container: .mobile-navbar (fixed bottom, z-index navbar)
- Icone: .nav-icons-group con transform: translateY(25%) GIÀ IMPLEMENTATO
- Variables: --nav-icon-vert-offset: 25% PRESENTE
- "Tutti": .btn-tutti separato, margin-left: auto
- STATO: Offset icone già presente nel CSS ma potrebbe non essere applicato

SAFE-AREA VARIABLES (tokens.css):
- --safe-top: env(safe-area-inset-top, 0px) ✅
- --safe-bottom: env(safe-area-inset-bottom, 0px) ✅  
- --safe-left: env(safe-area-inset-left, 0px) ✅
- --safe-right: env(safe-area-inset-right, 0px) ✅

GESTISCI ORDINI (gestisci-ordini-mobile.css):
- Container: height: 100dvh (CORRETTO, usa dynamic viewport)
- Header: padding-top: max(var(--safe-top), 0px) + 16px
- Content: padding-bottom: max(var(--safe-bottom), 0px) + 16px
- STATO: Safe-area implementata correttamente

HOMEPAGE CONTAINER:
- Height: 100vh (PROBLEMA: dovrebbe essere 100dvh)
- Content padding: calc(var(--safe-top) + 60pt) top
- Content padding: calc(var(--safe-bottom) + 60pt) bottom
- STATO: Safe-area implementata ma usa 100vh problematico

=== DIAGNOSI FINALE ===
Il problema principale sembra essere:
1. HomePage usa 100vh invece di 100dvh
2. L'offset icone navbar potrebbe non essere applicato correttamente
3. Possibili conflitti CSS che sovrascrivono le regole

AZIONI RICHIESTE:
1. Verificare applicazione transform: translateY(25%) su .nav-icons-group
2. Sostituire 100vh con 100dvh in HomePage
3. Verificare z-index e specificità CSS per navbar

=== FIX IMPLEMENTATI ===
Data: 28/09/2025 16:25

1. **NAVBAR ICONE OFFSET**:
   ✅ Modificato --nav-icon-vert-offset da 25% a 6pt (più preciso)
   ✅ Transform translateY(6pt) applicato a .nav-icons-group
   ✅ Icone ora spostate verso basso di 6pt nel container

2. **VIEWPORT DINAMICO**:
   ✅ Homepage: height: 100dvh con fallback 100vh
   ✅ GestisciOrdiniPage: height: 100dvh inline style
   ✅ Fix per iOS Safari barra URL dinamica

3. **FEATURE FLAG**:
   ✅ Aggiunto MOBILE_SAFE_AREAS flag per controllo rollback
   ✅ Enabled: true per attivazione immediata

4. **SAFE-AREA ESISTENTI**:
   ✅ Verificate variabili CSS --safe-top/bottom/left/right
   ✅ Gestisci Ordini già usa padding dinamico corretto
   ✅ Mobile-standard.css già implementa safe-area

=== RISULTATI ATTESI ===
- Icone navbar visivamente più in basso di 6pt
- HomePage stabile su iOS Safari (no salti barra URL)
- Header Gestisci Ordine sempre visibile
- "Tutti" pill completamente invariata
- Lente a destra campanella mantenuta

=== ROLLBACK ===
Per disattivare: MOBILE_SAFE_AREAS.enabled = false
Files modificati:
- src/styles/layout/mobile-standard.css (offset icone + viewport)
- src/pages/GestisciOrdiniPage.tsx (viewport dvh)
- src/config/featureFlags.ts (nuovo flag)
